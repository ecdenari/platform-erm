@using PureGreenLandGroup.Models.ViewModel.Inspection
@model PureGreenLandGroup.Models.ViewModel.Inspection.InspectionMasterViewModel
@{
    bool isProgramARunning = false;
    bool isProgramBRunning = false;
    bool isProgramCRunning = false;
    bool isProgramDRunning = false;
    int activeProgramsCount = 0;
    if (Model.ProgramDetailsList != null && Model.ProgramDetailsList.Count > 0)
    {
        for (int i = 0; i < 4; i++)
        {

            switch (i)
            {
                case 0:
                    if (Model.ProgramDetailsList[i].IsMonEnable || Model.ProgramDetailsList[i].IsTueEnabled || Model.ProgramDetailsList[i].IsWedEnabled || Model.ProgramDetailsList[i].IsThuEnabled || Model.ProgramDetailsList[i].IsFriEnabled || Model.ProgramDetailsList[i].IsSatEnabled || Model.ProgramDetailsList[i].IsSunEnable)
                    {
                        isProgramARunning = true;
                        activeProgramsCount++;
                    }
                    break;
                case 1:
                    if (Model.ProgramDetailsList[i].IsMonEnable || Model.ProgramDetailsList[i].IsTueEnabled || Model.ProgramDetailsList[i].IsWedEnabled || Model.ProgramDetailsList[i].IsThuEnabled || Model.ProgramDetailsList[i].IsFriEnabled || Model.ProgramDetailsList[i].IsSatEnabled || Model.ProgramDetailsList[i].IsSunEnable)
                    {
                        isProgramBRunning = true;
                        activeProgramsCount++;
                    }
                    break;
                case 2:
                    if (Model.ProgramDetailsList[i].IsMonEnable || Model.ProgramDetailsList[i].IsTueEnabled || Model.ProgramDetailsList[i].IsWedEnabled || Model.ProgramDetailsList[i].IsThuEnabled || Model.ProgramDetailsList[i].IsFriEnabled || Model.ProgramDetailsList[i].IsSatEnabled || Model.ProgramDetailsList[i].IsSunEnable)
                    {
                        isProgramCRunning = true;
                        activeProgramsCount++;
                    }
                    break;
                case 3:
                    if (Model.ProgramDetailsList[i].IsMonEnable || Model.ProgramDetailsList[i].IsTueEnabled || Model.ProgramDetailsList[i].IsWedEnabled || Model.ProgramDetailsList[i].IsThuEnabled || Model.ProgramDetailsList[i].IsFriEnabled || Model.ProgramDetailsList[i].IsSatEnabled || Model.ProgramDetailsList[i].IsSunEnable)
                    {
                        isProgramDRunning = true;
                        activeProgramsCount++;
                    }
                    break;
                default:
                    break;
            }
        }
    }
}

<div class="row">
    <div class="zoneIssueDatatable">
        <div class="table-responsive">
            <table class="zone-issues-table w-100 mt-2 table table-bordered cstm-dropdown" id="zoneIssueData-Table">
                <thead>
                    <tr>
                        <th scope="col">Zone</th>
                        @if (activeProgramsCount > 0)
                        {
                            <th scope="col" colspan="@activeProgramsCount">Programs</th>
                        }
                        <th scope="col">Valve Status</th>
                        <th scope="col">Clogged Nozzle</th>
                        <th scope="col">Broken Drip</th>
                        <th scope="col">Broken Spray</th><!--before it was Broken Head-->
                        <th scope="col">Broken Rotor</th><!--before it was Raise Head-->
                        <th scope="col">Raise/Lower</th>
                        <th scope="col">Move Head</th>
                        <th scope="col">Broken Lateral</th>
                        <th scope="col">Broken Main</th>
                        <th scope="col" colspan="3">Comment</th>
                        <th scope="col">Photos</th>
                        <th scope="col">Settings</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel != null && Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > 0)
                    {

                        <input type="hidden" value="@Model.ZonesList.Count " id="InspectionZoneCount" />
                        var counter = 0;
                        @foreach (var zone in Model.ZonesList)
                        {
                            if (Model.CreateInspectionViewModel.Id == 0)
                            {
                                Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM = new InspectedValveFailVM();
                            }
                            <input type="hidden" id="ZoneIssueId_index@(counter)" asp-for="@zone.Id" />
                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel!.Count > counter)
                            {
                                <input type="hidden" id="InspectedZoneIssuesId_index@(counter)" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].Id" />
                            }
                            else
                            {
                                <input type="hidden" id="InspectedZoneIssuesId_index@(counter)" />
                            }
                            <tr>
                                <td>
                                    <div class="block-number d-flex align-items-center justify-content-center">
                                        <span class="block-number-inner">@(counter + 1)</span>
                                    </div>
                                </td>

                                @if (isProgramARunning)
                                {
                                    <td>@Model.ZonesList[counter].ProgramA<span class="programNamingSpans">A</span></td>
                                }
                                @if (isProgramBRunning)
                                {
                                    <td>@Model.ZonesList[counter].ProgramB<span class="programNamingSpans">B</span></td>
                                }
                                @if (isProgramCRunning)
                                {
                                    <td>@Model.ZonesList[counter].ProgramC<span class="programNamingSpans">C</span></td>
                                }
                                @if (isProgramDRunning)
                                {
                                    <td>@Model.ZonesList[counter].ProgramD<span class="programNamingSpans">D</span></td>
                                }

                                <!--Valve Status-->
                                <td class="zoneIssuesEditableCols ValveStatusInput" id="ValveFailTd_zoneIndex@(zone.Id)_popupindex@(counter + 1)">
                                    <div>
                                        <span class="dropdown-select-content">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                            {
                                                @if (!string.IsNullOrEmpty(Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].ValveStatus))
                                                {
                                                    @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].ValveStatus
                                                }
                                            }
                                        </span>
                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                        {
                                            <input type="hidden" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].ValveStatus" />
                                        }
                                    </div>
                                </td>
                                <!--Valve status popup begins-->
                                <div class="modal fade modal-lg" id="ValveFailPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-scrollable">
                                        <div class="modal-content overflow-visible">
                                            <div class="modal-header d-flex justify-content-center">
                                                <h5 class="modal-title">Valve Fail</h5>
                                                <button type="button" class="btn-close inspectionBtnClose" data-bs-dismiss="modal" aria-label="Close" onclick="$('.brokenhead-menu').removeClass('active');"><i class="fa-solid fa-xmark"></i></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row m-2 mb-4">
                                                    <div class="col-4">
                                                        <label>Manufacturer</label>
                                                    </div>
                                                    <div class="col">
                                                        <input type="hidden" id="ValveFail_Id_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.Id">

                                                        <!--inputs for the reset event-->
                                                        <input type="hidden" id="SavedValveIssueValue_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsValveIssue" />
                                                        <input type="hidden" id="SavedDecoderIssueValue_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsDecoderIssue" />
                                                        <input type="hidden" id="SavedDecoderModelIdValue_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.DecoderModelId" />
                                                        <input type="hidden" id="SavedSolenoidIssueValue_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsSolenoidIssue" />
                                                        <select class="form-select" id="ValveFail_ManufacturerId_@counter" onchange="BindModelDropdown(this,'@counter','inspection')">
                                                            <option value="0">--select manufacturer--</option>
                                                            @if (Model.ManufacturerList != null && Model.ManufacturerList.Count > 0)
                                                            {
                                                                @foreach (var manufacturer in Model.ManufacturerList)
                                                                {
                                                                    @*if (Model.GetControllersViewModel.Manufacturer == manufacturer.ManufacturerName)*@
                                                                    if (Model.ZonesList[counter].ManufacturerId == manufacturer.Id)
                                                                    {
                                                                        <option value="@manufacturer.Id" selected>@manufacturer.ManufacturerName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@manufacturer.Id">@manufacturer.ManufacturerName</option>
                                                                    }
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row m-2 mb-4">
                                                    <div class="col-4">
                                                        <label>Valve size</label>
                                                    </div>
                                                    <div class="col">
                                                        <select class="form-select" id="ValveFail_ValveSize_@counter">
                                                            <option value="0">--select valve size--</option>
                                                            @if (Model.ValveSizeList != null && Model.ValveSizeList.Count > 0)
                                                            {
                                                                @foreach (var valveSize in Model.ValveSizeList)
                                                                {
                                                                    if (Model.ZonesList[counter].ValveSizeId == valveSize.Id)
                                                                    {
                                                                        <option value="@valveSize.Id" selected>@valveSize.ValveSizenames</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@valveSize.Id">@valveSize.ValveSizenames</option>
                                                                    }
                                                                }
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row m-2">
                                                    <div class="col-4">
                                                        <label>Issue type</label>
                                                    </div>
                                                    <div class="col">
                                                        <div class="row">
                                                            <div class="col">
                                                                @{
                                                                    var isValveIssue = @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsValveIssue;
                                                                    if (isValveIssue)
                                                                    {
                                                                        <input checked type="checkbox" id="ValveFail_IsValveIssue_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsValveIssue">
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="checkbox" id="ValveFail_IsValveIssue_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsValveIssue">
                                                                    }
                                                                }

                                                                <label for="ValveFail_IsValveIssue_@counter" class="mb-1">Valve issue</label>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col">
                                                                @{
                                                                    var isSolenoidIssue = @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsSolenoidIssue;
                                                                    if (isSolenoidIssue)
                                                                    {
                                                                        <input checked type="checkbox" id="ValveFail_IsSolenoidIssue_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsSolenoidIssue">
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="checkbox" id="ValveFail_IsSolenoidIssue_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsSolenoidIssue">
                                                                    }
                                                                }
                                                                <label for="ValveFail_IsSolenoidIssue_@counter" class="mb-1">Solenoid issue</label>
                                                            </div>
                                                        </div>
                                                        <!--check if controller is two wire type to show decoder option-->
                                                        @if (Model.GetControllersViewModel.ControllerType == 2)
                                                        {
                                                            <div class="row">
                                                                <div class="col">
                                                                    @{
                                                                        var isDecoderIssue = @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsDecoderIssue;
                                                                        if (isDecoderIssue)
                                                                        {
                                                                            <input checked type="checkbox" id="ValveFail_IsDecoderIssue_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsDecoderIssue" onchange="DecoderInputs(event,'@counter')">
                                                                        }
                                                                        else
                                                                        {
                                                                            <input type="checkbox" id="ValveFail_IsDecoderIssue_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsDecoderIssue" onchange="DecoderInputs(event,'@counter')">
                                                                        }
                                                                    }
                                                                    <label for="ValveFail_IsDecoderIssue_@counter" class="mb-1">Decoder issue</label>
                                                                </div>
                                                            </div>
                                                        }
                                                    </div>
                                                </div>
                                                <!--show decoder model select input if decoder is checked on update inspection page-->
                                                @if (Model.CreateInspectionViewModel.Id > 0 && @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.IsDecoderIssue)
                                                {
                                                    <div class="row m-2 mb-4" id="decoderInputs_@counter">
                                                        <div class="row mb-3">
                                                            <div class="col-4">
                                                                <label>Decoder manufacturer</label>
                                                            </div>
                                                            <div class="col">
                                                                <input type="text" value="@Model.GetControllersViewModel.Manufacturer" disabled class="form-control" />
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-4">
                                                                <label>Decoder model</label>
                                                            </div>
                                                            <div class="col">
                                                                <div class="row">
                                                                    <div class="col">
                                                                        <select class="form-select" id="ValveFail_Decoder_ModelId_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].InspectedValveFailVM.DecoderModelId">
                                                                            <option value="0">--select model--</option>
                                                                            @if (Model.ModelsList != null && Model.ModelsList.Count > 0)
                                                                            {
                                                                                if (!string.IsNullOrEmpty(Model.GetControllersViewModel.Manufacturer))
                                                                                {
                                                                                    var savedManufacturer = Model.ManufacturerList!.Where(m => m.ManufacturerName == Model.GetControllersViewModel.Manufacturer).FirstOrDefault();
                                                                                    if (savedManufacturer != null && savedManufacturer.Id > 0)
                                                                                    {
                                                                                        @foreach (var modelItem in Model.ModelsList.Where(m => m.ManufacturerId == savedManufacturer!.Id))
                                                                                        {
                                                                                            <option value="@modelItem.Id">@modelItem.ModelName</option>
                                                                                        }
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        @foreach (var modelItem in Model.ModelsList)
                                                                                        {
                                                                                            <option value="@modelItem.Id">@modelItem.ModelName</option>
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    @foreach (var modelItem in Model.ModelsList)
                                                                                    {
                                                                                        <option value="@modelItem.Id">@modelItem.ModelName</option>
                                                                                    }
                                                                                }
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="row m-2 mb-3" style="display:none;" id="decoderInputs_@counter">
                                                        <div class="row mb-3">
                                                            <div class="col-4">
                                                                <label>Decoder manufacturer</label>
                                                            </div>
                                                            <div class="col">
                                                                <input type="text" value="@Model.GetControllersViewModel.Manufacturer" disabled class="form-control" />
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-4">
                                                                <label>Decoder model</label>
                                                            </div>
                                                            <div class="col">
                                                                <div class="row">
                                                                    <div class="col">
                                                                        <select class="form-select" id="ValveFail_Decoder_ModelId_@counter">
                                                                            <option value="0">--select model--</option>
                                                                            @if (Model.ModelsList != null && Model.ModelsList.Count > 0)
                                                                            {
                                                                                if (!string.IsNullOrEmpty(Model.GetControllersViewModel.Manufacturer))
                                                                                {
                                                                                    var savedManufacturer = Model.ManufacturerList!.Where(m => m.ManufacturerName == Model.GetControllersViewModel.Manufacturer).FirstOrDefault();
                                                                                    if (savedManufacturer != null && savedManufacturer.Id > 0)
                                                                                    {
                                                                                        @foreach (var modelItem in Model.ModelsList.Where(m => m.ManufacturerId == savedManufacturer!.Id))
                                                                                        {
                                                                                            <option value="@modelItem.Id">@modelItem.ModelName</option>
                                                                                        }
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                        @foreach (var modelItem in Model.ModelsList)
                                                                                        {
                                                                                            <option value="@modelItem.Id">@modelItem.ModelName</option>
                                                                                        }
                                                                                    }
                                                                                }
                                                                                else
                                                                                {
                                                                                    @foreach (var modelItem in Model.ModelsList)
                                                                                    {
                                                                                        <option value="@modelItem.Id">@modelItem.ModelName</option>
                                                                                    }
                                                                                }
                                                                            }
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                }

                                                <div class="modal-footer d-flex justify-content-center">
                                                    <button type="button" class="btn btn-secondary" onclick="ResetValveStatus(event,'@zone.Id','@(counter+1)');">Reset Status</button>
                                                    <button type="button" class="btn btn-success" onclick="$('.modal').modal('hide');">Save & Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Valve status  popup ends-->
                                <!--Clogged Nozzle-->
                                <td class="zoneIssuesEditableCols CloggedNozzleTdInput" id="CloggedNozzleTd_zoneIndex@(zone.Id)_popupindex@(counter + 1)">
                                    <div>
                                        <span class="dropdown-select-content">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                            {
                                                var mprNozzle = Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].MprCloggedNozzle;
                                                var vanNozzle = Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].VanCloggedNozzle;
                                                @if (mprNozzle > 0 || vanNozzle > 0)
                                                {
                                                    @(mprNozzle + vanNozzle)
                                                }
                                            }
                                        </span>
                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                        {
                                            <input type="hidden" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].CloggedNozzle" />
                                        }
                                    </div>
                                </td>
                                <!--Clogged nozzle popup begins-->
                                <div class="modal fade modal-lg " id="CloggedNozzlePopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-scrollable">
                                        <div class="modal-content overflow-visible">
                                            <div class="modal-header d-flex justify-content-center">
                                                <h5 class="modal-title">Clogged Nozzle</h5>
                                                <button type="button" class="btn-close inspectionBtnClose" data-bs-dismiss="modal" aria-label="Close" onclick="$('.brokenhead-menu').removeClass('active');"><i class="fa-solid fa-xmark"></i></button>
                                            </div>
                                            <div class="modal-body">
                                                <div class="row m-2 mb-4">
                                                    <div class="col-4">
                                                        <label for="CloggedMprNozzle_@counter">MPR Nozzle</label>
                                                    </div>
                                                    <div class="col">
                                                        <input type="hidden" id="Saved_CloggedMprNozzle_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].MprCloggedNozzle" />
                                                        <input type="hidden" id="Saved_CloggedVanNozzle_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].VanCloggedNozzle" />
                                                        <select class="form-select mprNozzleInput" id="CloggedMprNozzle_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].MprCloggedNozzle">
                                                            <option value="0">--select mpr nozzles count--</option>
                                                            @for (int i = 1; i <= 10; i++)
                                                            {
                                                                <option value="@i">@i</option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row m-2">
                                                    <div class="col-4">
                                                        <label for="CloggedVanNozzle_@counter">Van Nozzle</label>
                                                    </div>
                                                    <div class="col">
                                                        <select class="form-select vanNozzleInput" id="CloggedVanNozzle_@counter" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].VanCloggedNozzle">
                                                            <option value="0">--select van nozzles count--</option>
                                                            @for (int i = 1; i <= 10; i++)
                                                            {
                                                                <option value="@i">@i</option>
                                                            }
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer d-flex justify-content-center">
                                                <button type="button" class="btn btn-secondary" onclick="ResetCloggedNozzle('@(counter+1)');">Reset Value</button>
                                                <button type="button" class="btn btn-success" onclick="SaveCloggedNozzle(event,'@zone.Id','@(counter+1)','set');">Save & Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Clogged nozzle  popup ends-->
                                <!--Broken drip input block-->
                                <td class="zoneIssuesEditableCols BrokenDripTdInput" id="BrokenDripTd_zoneIndex@(zone.Id)_popupindex@(counter + 1)">
                                    <div>
                                        <span class="dropdown-select-content">

                                        </span>
                                        @* @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                {
                                <input type="hidden" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].ValveStatus" />
                                } *@
                                    </div>
                                </td>

                                <!--Broken Drip popup begins-->
                                <div class="modal fade modal-lg" id="BrokenDripPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-scrollable">
                                        <div class="modal-content overflow-visible">
                                            <div class="modal-header d-flex justify-content-center">
                                                <h5 class="modal-title">Broken Drip</h5>
                                                <button type="button" class="btn-close inspectionBtnClose" data-bs-dismiss="modal" aria-label="Close" onclick="$('.brokenhead-menu').removeClass('active');"><i class="fa-solid fa-xmark"></i></button>
                                            </div>
                                            @{
                                                var isSavedInspection = (Model.CreateInspectionViewModel.Id > 0) ? true : false;
                                            }
                                            <div class="modal-body ">
                                                <div class="row m-2 mb-4 align-items-center">
                                                    <div class="col-5">
                                                        <div class="d-flex align-items-center gap-3">
                                                            <input type="checkbox" id="IsSplice_@counter" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].IsSplice" onchange="SpliceRepairInputs('@counter')">
                                                            <label for="IsSplice_@counter">Splice</label>
                                                        </div>
                                                    </div>
                                                    <div class="col-7">
                                                        @if (isSavedInspection)
                                                        {
                                                            <input type="number" class="form-control" placeholder="Enter number of splice" id="SpliceCount_@counter" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].SpliceCount" />
                                                        }
                                                        else
                                                        {
                                                            <input type="number" class="form-control" placeholder="Enter number of splice" id="SpliceCount_@counter" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].SpliceCount" disabled />
                                                        }
                                                    </div>
                                                </div>
                                                <div class="row m-2 align-items-center">
                                                    <div class="col-5">
                                                        <div class="d-flex align-items-center gap-3">
                                                            <input type="checkbox" id="IsLinearRepair_@counter" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].IsLinearRepair" onchange="LinearRepairInputs('@counter')">
                                                            <label for="IsLinearRepair_@counter">Linear Repair</label>
                                                        </div>
                                                    </div>

                                                    <div class="col-7">
                                                        @if (isSavedInspection)
                                                        {
                                                            <select class="form-select" id="LinearRepairValue_@counter" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].LinearRepairValueId">
                                                                <option value="0">--select value--</option>
                                                                <option value="1">@Html.Raw("Less 5'")</option>
                                                                <option value="2">@Html.Raw("5' - 10'")</option>
                                                                <option value="3">@Html.Raw("10'+")</option>
                                                            </select>
                                                        }
                                                        else
                                                        {
                                                            <select class="form-select" id="LinearRepairValue_@counter" disabled asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel![counter].LinearRepairValueId">
                                                                <option value="0">--select value--</option>
                                                                <option value="1">@Html.Raw("Less 5'")</option>
                                                                <option value="2">@Html.Raw("5' - 10'")</option>
                                                                <option value="3">@Html.Raw("10'+")</option>
                                                            </select>
                                                        }
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="modal-footer d-flex justify-content-center">
                                                <button type="button" class="btn btn-success" onclick="SaveAndCloseBrokenDrip(event);">Save & Close</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--Broken Drip popup ends-->
                                <!--Broken Spray-->
                                <td class="select-menu zoneIssuesEditableCols" id="BlockedHeadDropdown_@counter">
                                    <div class="select-btn ZoneCommonInput">
                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                        {
                                            @if (@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].BrokenSpray > 0)
                                            {
                                                <span class="sBtn-text dropdown-select-content">
                                                    @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].BrokenSpray
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                            }
                                        }
                                        else
                                        {
                                            <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                        }
                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                        {
                                            <input type="hidden" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].BrokenSpray" />
                                        }
                                    </div>
                                    <ul class="options">
                                        @await Html.PartialAsync("_zoneIssuesInputDropdown")
                                        <li class="option" data-value="26"><span class="option-text">None</span></li>
                                        <li class="option" data-value="27"><span class="option-text">Cancel</span></li>
                                    </ul>
                                </td>
                                <!--Broken Rotor-->
                                <td class="select-menu zoneIssuesEditableCols" id="BrokenHeadDropdown_@counter">
                                    <div class="select-btn ZoneCommonInput">
                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                        {
                                            @if (@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].BrokenRotor > 0)
                                            {
                                                <span class="sBtn-text dropdown-select-content">
                                                    @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].BrokenRotor
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                            }
                                            <input type="hidden" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].BrokenRotor" />
                                        }
                                    </div>
                                    <ul class="options">
                                        @await Html.PartialAsync("_zoneIssuesInputDropdown")
                                        <li class="option" data-value="26"><span class="option-text">None</span></li>
                                        <li class="option" data-value="27"><span class="option-text">Cancel</span></li>
                                    </ul>
                                </td>

                                <!--Raise/Lower-->
                                <td class="select-menu zoneIssuesEditableCols" id="RaiseHeadDropdown_@counter">
                                    <div class="select-btn ZoneCommonInput">
                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                        {
                                            @if (@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].RaiseLower > 0)
                                            {
                                                <span class="sBtn-text dropdown-select-content">
                                                    @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].RaiseLower
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                            }
                                            <input type="hidden" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].RaiseLower" />
                                        }
                                    </div>
                                    <ul class="options">
                                        @await Html.PartialAsync("_zoneIssuesInputDropdown")
                                        <li class="option" data-value="26"><span class="option-text">None</span></li>
                                        <li class="option" data-value="27"><span class="option-text">Cancel</span></li>
                                    </ul>

                                </td>
                                <!--Move new input-->
                                <td class=" zoneIssuesEditableCols p-0">
                                    <div class="d-flex align-items-center zoneIssuesbl">
                                        <a class="bl-items" data-bs-toggle="modal" data-bs-target="#MoveHeadPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" disabled>
                                            <i class="fas fa-pencil-alt"></i>
                                        </a>
                                        <div class="ZoneCommonInput bl-items">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                            {
                                                @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList != null && @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList.Count > 0)
                                                {
                                                    <span class="sBtn-text dropdown-select-content">
                                                        @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList.Count
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                                }
                                                <input type="hidden" id="MoveHeadPopup_zoneIndex@(zone.Id)_count" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList.Count" />
                                            }
                                        </div>
                                        <div class="brokenhead-menu bl-items" id="BrokenLateralInputSelect">
                                            <div class="brokenhead-btn  ">
                                                <button class="btn border-0 brokenHeadDropdownToggleBtn " type="button" aria-expanded="false">
                                                    <i class="fas fa-caret-down"></i>
                                                </button>

                                                <ul class="brokenhead-dropdown">
                                                    @for (int dropdownValue = 1; dropdownValue <= 25; dropdownValue++)
                                                    {
                                                        <li class="brokenhead-option" data-value="@dropdownValue" onclick="SetBrokenHeads(event,'@dropdownValue','movehead','@zone.Id','@(counter + 1)');event.stopPropagation();">
                                                            <span class="brokenhead-option-text">@dropdownValue</span>
                                                        </li>
                                                    }
                                                    <li class="brokenhead-option" data-value="27"><span class="option-text" onclick="CloseBrokenHeadDropdown();event.stopPropagation();">Cancel</span></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <!--Broken Lateral-->
                                <td class="zoneIssuesEditableCols p-0">
                                    <div class="d-flex align-items-center zoneIssuesbl">
                                        <a class="bl-items" data-bs-toggle="modal" data-bs-target="#BrokenLateralPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" disabled>
                                            <i class="fas fa-pencil-alt"></i>
                                        </a>
                                        <div class="ZoneCommonInput bl-items">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                            {
                                                @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList != null && @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList!.Count > 0)
                                                {
                                                    <span class="sBtn-text dropdown-select-content">
                                                        @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList!.Count
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                                }
                                                <input type="hidden" id="BrokenLateralPopup_zoneIndex@(zone.Id)_count" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList!.Count" />
                                            }
                                        </div>
                                        <div class="brokenhead-menu bl-items" id="BrokenLateralInputSelect">
                                            <div class="brokenhead-btn  ">
                                                <button class="btn border-0 brokenHeadDropdownToggleBtn " type="button" aria-expanded="false">
                                                    <i class="fas fa-caret-down"></i>
                                                </button>

                                                <ul class="brokenhead-dropdown">
                                                    @for (int dropdownValue = 1; dropdownValue <= 25; dropdownValue++)
                                                    {
                                                        <li class="brokenhead-option" data-value="@dropdownValue" onclick="SetBrokenHeads(event,'@dropdownValue','lateralhead','@zone.Id','@(counter + 1)');event.stopPropagation();">
                                                            <span class="brokenhead-option-text">@dropdownValue</span>
                                                        </li>
                                                    }
                                                    <li class="brokenhead-option" data-value="27"><span class="option-text" onclick="CloseBrokenHeadDropdown();event.stopPropagation();">Cancel</span></li>
                                                </ul>

                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <!--Broken Main-->
                                <td class="zoneIssuesEditableCols p-0 ">
                                    <div class="d-flex align-items-center zoneIssuesbl">
                                        <a class="bl-items" data-bs-toggle="modal" data-bs-target="#BrokenMainPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)">
                                            <i class="fas fa-pencil-alt"></i>
                                        </a>
                                        <div class="ZoneCommonInput bl-items">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                            {
                                                @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel != null && @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel.Count > 0)
                                                {
                                                    <span class="sBtn-text dropdown-select-content">
                                                        @Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel.Count
                                                    </span>
                                                }
                                                else
                                                {
                                                    <span class="sBtn-text dropdown-select-content"> &nbsp;</span>
                                                }
                                                <input type="hidden" id="BrokenMainPopup_zoneIndex@(zone.Id)_count" asp-for="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel.Count" />
                                            }
                                        </div>
                                        <div class="brokenhead-menu bl-items" id="BrokenMainInputSelect">
                                            <div class="brokenhead-btn">
                                                <button class="btn border-0 brokenHeadDropdownToggleBtn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                                    <i class="fas fa-caret-down"></i>
                                                </button>

                                                <ul class="brokenhead-dropdown">
                                                    @for (int dropdownValue = 1; dropdownValue <= 25; dropdownValue++)
                                                    {
                                                        <li class="brokenhead-option" data-value="@dropdownValue" onclick="SetBrokenHeads(event,'@dropdownValue','brokenhead','@zone.Id','@(counter + 1)');event.stopPropagation();">
                                                            <span class="brokenhead-option-text">@dropdownValue</span>
                                                        </li>
                                                    }
                                                    <li class="brokenhead-option" data-value="27"><span class="option-text" onclick="CloseBrokenHeadDropdown();event.stopPropagation();">Cancel</span></li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                                <!--Comment-->
                                <td colspan="3" class="p-0 zoneissue-comment" style="">
                                    @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                    {
                                        <textarea type="text" placeholder="Enter comment" class="form-control" id="InspectionZoneComment_@counter" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].Comment" style="border-radius:0px;"></textarea>
                                    }
                                    else
                                    {
                                        <textarea type="text" placeholder="Enter comment" class="form-control" id="InspectionZoneComment_@counter" style="border-radius:0px;"></textarea>
                                    }
                                </td>
                                <!--Photos-->
                                <td>
                                    <button class="btn btn-sm btn-outline-success irrigation-photo-btn " data-bs-toggle="modal" data-bs-target="#ZoneImagesPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)">+</button>
                                </td>
                                <!--Settings-->
                                <td>
                                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#ZoneIrrigationSettingsPopup_@(counter + 1)"><i class="fa-solid fa-pen-to-square"></i></button>
                                </td>
                            </tr>
                            <!--second row for the zone description and the sprinkler input-->
                            <tr>
                                <td colspan="@(activeProgramsCount + 7)" class="p-0" style="vertical-align: middle;">
                                    <input type="hidden" id="InspectionZoneId_@counter" value="@zone.Id" />
                                    <textarea type="text" id="InspectionZoneDescription_@counter" placeholder="Zone description" class="form-control sprinklerdrop-textarea" rows="2" style="border-radius: 0px;">@Model.ZonesList[counter].Description</textarea>
                                </td>
                                <td colspan="@(activeProgramsCount + 7)" class="p-0" style="vertical-align: middle;">
                                    <div class="sprinklerdrop">
                                        <label>Sprinkler Type</label>
                                        <div class="">
                                            <input type="hidden" id="Saved_InspectionZoneSprinklerId_@counter" value="@Model.ZonesList[counter].SprinkleTypeId" />
                                            <select class="form-select" id="InspectionZoneSprinklerId_@counter">
                                                <option value="0">--select sprinkler--</option>
                                                @foreach (var sprinklerType in Model.SprinklerTypesList!)
                                                {
                                                    if (Model.ZonesList[counter].SprinkleTypeId == sprinklerType.Id)
                                                    {
                                                        <option value="@sprinklerType.Id" selected>@sprinklerType.SprinklerTypeName</option>
                                                    }
                                                    else
                                                    {
                                                        <option value="@sprinklerType.Id">@sprinklerType.SprinklerTypeName</option>
                                                    }
                                                }
                                            </select>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <!--Irrigation settings popup begins-->
                            <div class="modal fade modal-lg" id="ZoneIrrigationSettingsPopup_@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header d-flex justify-content-center" id="ZoneIrrigationSettingsPopup-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Irrigation settings</h5>
                                            <button type="button" class="btn-close inspectionBtnClose" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
                                        </div>
                                        <div class="modal-body">
                                            <div>
                                                <div class="modal-area modalBodyContent">
                                                    <div class="row mb-3">
                                                        <div class="col-3">
                                                            <label>Area %</label>
                                                        </div>
                                                        <div class="col">
                                                            <select class="form-select" id="InspectionZoneArea_@counter">
                                                                @foreach (var zoneArea in Model.ZoneAreaDropDown!)
                                                                {
                                                                    @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                                                    {
                                                                        if (zoneArea.Id == Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].Area)
                                                                        {
                                                                            <option value="@zoneArea.Id" selected>@zoneArea.Value</option>
                                                                        }
                                                                        else
                                                                        {
                                                                            <option value="@zoneArea.Id">@zoneArea.Value</option>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@zoneArea.Id">@zoneArea.Value</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                            <div>
                                                <div class="modal-irrigation modalBodyContent">
                                                    @*  <div class="row p-2">
                                            <div class="col-3">
                                            <label>Sprinkler Type</label>
                                            </div>
                                            <div class="col">
                                            <input type="hidden" id="Saved_InspectionZoneSprinklerId_@counter" value="@Model.ZonesList[counter].SprinkleTypeId" />
                                            <select class="form-select" id="InspectionZoneSprinklerId_@counter">
                                            <option value="0">--select sprinkler--</option>
                                            @foreach (var sprinklerType in Model.SprinklerTypesList!)
                                            {
                                            if (Model.ZonesList[counter].SprinkleTypeId == sprinklerType.Id)
                                            {
                                            <option value="@sprinklerType.Id" selected>@sprinklerType.SprinklerTypeName</option>
                                            }
                                            else
                                            {
                                            <option value="@sprinklerType.Id">@sprinklerType.SprinklerTypeName</option>
                                            }
                                            }
                                            </select>
                                            </div>
                                            </div> *@
                                                    <div class="row p-2">
                                                        <div class="col-3">
                                                            <label>Plant Type</label>
                                                        </div>
                                                        <div class="col">
                                                            <input type="hidden" id="Saved_InspectionZonePlantId_@counter" value="@Model.ZonesList[counter].PlantTypeId" />
                                                            <select class="form-select" id="InspectionZonePlantId_@counter">
                                                                <option value="0">--select plant--</option>
                                                                @foreach (var plantType in Model.PlantTypeList!)
                                                                {
                                                                    if (Model.ZonesList[counter].PlantTypeId == plantType.Id)
                                                                    {
                                                                        <option value="@plantType.Id" selected>@plantType.PlantTypeName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@plantType.Id">@plantType.PlantTypeName</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row p-2">
                                                        <div class="col-3">
                                                            <label>Soil Type</label>
                                                        </div>
                                                        <div class="col">
                                                            <input type="hidden" id="Saved_InspectionZoneSoilId_@counter" value="@Model.ZonesList[counter].SoilTypeId" />
                                                            <select class="form-select" id="InspectionZoneSoilId_@counter">
                                                                <option value="0">--select soil--</option>
                                                                @foreach (var soilType in Model.SoilTypeList!)
                                                                {
                                                                    if (Model.ZonesList[counter].SoilTypeId == soilType.Id)
                                                                    {
                                                                        <option value="@soilType.Id" selected>@soilType.SoilTypeName</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@soilType.Id">@soilType.SoilTypeName</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row p-2">
                                                        <div class="col-3">
                                                            <label>Valve Size</label>
                                                        </div>
                                                        <div class="col">
                                                            <input type="hidden" id="Saved_InspectionZoneValveSizeId_@counter" value="@Model.ZonesList[counter].ValveSizeId" />
                                                            <select class="form-select" id="InspectionZoneValveSizeId_@counter">
                                                                @foreach (var valveSize in Model.ValveSizeList)
                                                                {
                                                                    if (Model.ZonesList[counter].ValveSizeId == valveSize.Id)
                                                                    {
                                                                        <option value="@valveSize.Id" selected>@valveSize.ValveSizenames</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@valveSize.Id">@valveSize.ValveSizenames</option>
                                                                    }
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="row p-2">
                                                        <div class="col-3">
                                                            <label>GPM</label>
                                                        </div>
                                                        <div class="col">
                                                            <div class="irrigation-gpm">
                                                                @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                                                {
                                                                    <input type="hidden" id="Saved_InspectionZoneGpmValue_@counter" value="@Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].GpmValue" />
                                                                }
                                                                @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                                                {
                                                                    <input class="form-control" id="InspectionZoneGpmValue_@counter" placeholder="0.00" pattern="[0-9]+([.][0-9]+)?" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].GpmValue" />
                                                                }
                                                                <input value="GPM" class="form-control" disabled />
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="text-end  mb-2">
                                                    <a class="btn undo-btn" onclick="ResetIrrigationSettings('@counter');">Undo Changes</a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer d-flex justify-content-center">
                                            <button type="button" class="btn btn-success" onclick="$('.modal').modal('hide')">Save & Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Irrigation settings popup ends-->
                            <!--Broken lateral  popup begins-->
                            <div class="modal fade modal-lg " id="BrokenLateralPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-scrollable">
                                    <div class="modal-content overflow-visible">
                                        <div class="modal-header d-flex justify-content-center">
                                            <h5 class="modal-title">Broken Lateral</h5>
                                            <button type="button" class="btn-close inspectionBtnClose" data-bs-dismiss="modal" aria-label="Close" onclick="$('.brokenhead-menu').removeClass('active');"><i class="fa-solid fa-xmark"></i></button>
                                        </div>
                                        <div class="modal-body">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter && Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList != null)
                                            {
                                                int brokenLateralCounter = 0;
                                                var savedBrokenLateralList = Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList;
                                                foreach (var brokenLateralItem in savedBrokenLateralList)
                                                {
                                                    int @brokenLateralDropdownCounter = 1;
                                                    <div class="row p-2">
                                                        <div class="col-2">
                                                            <h4>@(brokenLateralCounter + 1)#</h4>
                                                            <input type="hidden" id="BrokenLateralInput_zoneIndex@(zone.Id)_BrokenLateralInputId@(brokenLateralCounter)" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenLateralList[brokenLateralCounter].Id" />
                                                        </div>
                                                        <div class="col">
                                                            <select class="form-select" id="BrokenLateralInput_zoneIndex@(zone.Id)_input@(brokenLateralCounter)">
                                                                @foreach (var brokenLateralDropdownItems in Model.BrokenLateralDropdown.Where(m => m.IsBrokenLateralValue))
                                                                {
                                                                    if (brokenLateralItem.Value == brokenLateralDropdownItems.Id)
                                                                    {
                                                                        <option value="@brokenLateralDropdownCounter " selected>@brokenLateralDropdownItems.Value</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@brokenLateralDropdownCounter">@brokenLateralDropdownItems.Value</option>
                                                                    }
                                                                    brokenLateralDropdownCounter++;
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                    brokenLateralCounter++;
                                                }
                                            }
                                        </div>
                                        <div class="modal-footer d-flex justify-content-center">
                                            <button type="button" class="btn btn-success" onclick="$('.modal').modal('hide');$('.brokenhead-menu').removeClass('active');">Save & Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Broken lateral  popup ends-->
                            <!--Broken Main popup begins-->
                            <div class="modal fade modal-lg" id="BrokenMainPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header d-flex justify-content-center">
                                            <h5 class="modal-title">Broken Main</h5>
                                            <button type="button" class="btn-close inspectionBtnClose BrokenHeadClosePopupBtn" data-bs-dismiss="modal" aria-label="Close" onclick="$('.brokenhead-menu').removeClass('active');"><i class="fa-solid fa-xmark"></i></button>
                                        </div>
                                        <div class="modal-body">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter && Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel != null)
                                            {
                                                int brokenMainCounter = 0;
                                                var savedBrokenMainList = Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel;
                                                foreach (var brokenMainItem in savedBrokenMainList!)
                                                {
                                                    int @brokenMainDropdownCounter = 7;
                                                    var brokenMainDropdownList = Model.BrokenLateralDropdown!.Where(m => !m.IsBrokenLateralValue);
                                                    <div class="row p-2">
                                                        <div class="col-2">
                                                            <h4>@(brokenMainCounter + 1)#</h4>
                                                            <input type="hidden" id="BrokenMainInput_zoneIndex@(zone.Id)_BrokenMainInputId@(brokenMainCounter)" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneBrokenMainViewModel[brokenMainCounter].Id" />
                                                        </div>
                                                        <div class="col">
                                                            <select class="form-select" id="BrokenMainInput_zoneIndex@(zone.Id)_input@(brokenMainCounter)">
                                                                @foreach (var brokenMainDropdownItems in brokenMainDropdownList)
                                                                {
                                                                    if (brokenMainItem.Value == brokenMainDropdownItems.Id)
                                                                    {
                                                                        <option value="@brokenMainDropdownCounter " selected>@brokenMainDropdownItems.Value</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@brokenMainDropdownCounter">@brokenMainDropdownItems.Value</option>

                                                                    }
                                                                    brokenMainDropdownCounter++;
                                                                }
                                                            </select>
                                                        </div>
                                                    </div>
                                                    brokenMainCounter++;
                                                }
                                            }
                                        </div>
                                        <div class="modal-footer d-flex justify-content-center">
                                            <button type="button" class="btn btn-success" onclick="$('.modal').modal('hide');$('.brokenhead-menu').removeClass('active');">Save & Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Broken Main popup ends-->
                            <!--Move head popup begins-->
                            <div class="modal fade modal-lg" id="MoveHeadPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header d-flex justify-content-center">
                                            <h5 class="modal-title">Move Head</h5>
                                            <button type="button" class="btn-close inspectionBtnClose BrokenHeadClosePopupBtn" data-bs-dismiss="modal" aria-label="Close" onclick="$('.brokenhead-menu').removeClass('active');"><i class="fa-solid fa-xmark"></i></button>
                                        </div>
                                        <div class="modal-body">
                                            @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter && Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList != null)
                                            {
                                                int moveHeadCounter = 0;
                                                var savedMoveHeadList = Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList;
                                                foreach (var moveHeadItem in savedMoveHeadList)
                                                {
                                                    <div class="row p-2">
                                                        <div class="col-2">
                                                            <h4>@(moveHeadCounter + 1)#</h4>
                                                            <input type="hidden" id="MoveHeadInput_zoneIndex@(zone.Id)_MoveHeadInputId@(moveHeadCounter)" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedMoveHeadList[moveHeadCounter].Id" />
                                                        </div>
                                                        <div class="col">
                                                            <select class="form-select" id="MoveHeadInput_zoneIndex@(zone.Id)_input@(moveHeadCounter)">
                                                                @if (moveHeadItem.MoveHeadId == 1)
                                                                {
                                                                    <option value="1" selected>@Html.Raw("Move <3\'")</option>
                                                                    <option value="2">@Html.Raw("Move >3\'")</option>
                                                                }
                                                                else
                                                                {
                                                                    <option value="1">@Html.Raw("Move <3\'")</option>
                                                                    <option value="2" selected>@Html.Raw("Move >3\'")</option>
                                                                }

                                                            </select>
                                                        </div>
                                                    </div>
                                                    moveHeadCounter++;
                                                }
                                            }
                                        </div>
                                        <div class="modal-footer d-flex justify-content-center">
                                            <button type="button" class="btn btn-success" onclick="$('.modal').modal('hide');$('.brokenhead-menu').removeClass('active');">Save & Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Move head popup ends-->
                            <!--Zone issues images popup begins-->
                            <div class="modal fade modal-lg" id="ZoneImagesPopup_zoneIndex@(zone.Id)_popupindex@(counter + 1)" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header d-flex justify-content-center">
                                            <h5 class="modal-title">Zone Issues Photos</h5>
                                            <button type="button" class="btn-close inspectionBtnClose" data-bs-dismiss="modal" aria-label="Close"><i class="fa-solid fa-xmark"></i></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row mb-2 " id="PreviewZoneImageContainer_@(counter + 1)">
                                                @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter && Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneImagesList != null && Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneImagesList.Count > 0)
                                                {
                                                    int imageCounter = 0;
                                                    foreach (var imageModel in Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneImagesList)
                                                    {
                                                        <div class="row imgPreviewDiv">
                                                            <div class="col-4 col-lg-3 mb-2">
                                                                @{
                                                                    string imageFileName = System.IO.Path.GetFileName(imageModel.ImagePath);
                                                                    string imageRenderPath = $"~/applicationimages/zoneissuesimages/{imageFileName}";
                                                                    string viewOriginalImageLink = $"/applicationimages/zoneissuesimages/{imageFileName}";
                                                                }

                                                                <a href="@viewOriginalImageLink" target="_blank" class="w-100" title="click to see original file">
                                                                    <div class="imagePreview w-100">
                                                                        <input type="hidden" id="ImagePath_zoneIndex@(zone.Id)_inputIndex@(counter + 1)" value="@(imageModel.ImagePath)" />
                                                                        <img src="@viewOriginalImageLink" alt="zone image" />
                                                                    </div>
                                                                </a>
                                                            </div>
                                                            <div class="col-6 col-lg-7">
                                                                <div class="container">
                                                                    <div class="row pb-4">
                                                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                                                        {

                                                                            <input type="hidden" id="ZoneImageInput_zoneIndex@(zone.Id)_ZoneImageId@(imageCounter)" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneImagesList[imageCounter].Id" />
                                                                            <input type="text" class="form-control" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneImagesList[imageCounter].ImageCaption" id="ImageCaption_zoneIndex@(zone.Id)_inputIndex@(counter + 1)" placeholder="Enter image caption" />

                                                                        }
                                                                    </div>
                                                                    <div class="row pt-1 ">
                                                                        @if (Model.CreateInspectionViewModel.ZoneIssuesInspectionViewModel.Count > counter)
                                                                        {

                                                                            <select class="form-select" id="ImageIssues_zoneIndex@(zone.Id)_inputIndex@(counter + 1)" asp-for="CreateInspectionViewModel.ZoneIssuesInspectionViewModel[counter].InspectedZoneImagesList[imageCounter].ImageIssueStatus">
                                                                                <option value="0">Select Issue</option>
                                                                                <option value="1">Valve Status</option>
                                                                                <option value="2">Clogged Nozzle</option>
                                                                                <option value="3">Blocked Head</option>
                                                                                <option value="4">Broken Head</option>
                                                                                <option value="5">Raise Head</option>
                                                                                <option value="6">Lower Head</option>
                                                                                <option value="7">Replace Head</option>
                                                                                <option value="8">Broken Drip/Micro Spray</option>
                                                                                <option value="9">Broken Lateral</option>
                                                                            </select>
                                                                        }
                                                                        else
                                                                        {
                                                                            <select class="form-select" id="ImageIssues_zoneIndex@(zone.Id)_inputIndex@(counter + 1)">
                                                                                <option value="0">Select Issue</option>
                                                                                <option value="1">Valve Status</option>
                                                                                <option value="2">Clogged Nozzle</option>
                                                                                <option value="3">Blocked Head</option>
                                                                                <option value="4">Broken Head</option>
                                                                                <option value="5">Raise Head</option>
                                                                                <option value="6">Lower Head</option>
                                                                                <option value="7">Replace Head</option>
                                                                                <option value="8">Broken Drip/Micro Spray</option>
                                                                                <option value="9">Broken Lateral</option>
                                                                            </select>
                                                                        }
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="col-2 ">
                                                                <a href="#" class="btn btn-outline-warning " onclick="DeleteImage(event)"><i class="fas fa-trash-alt"></i></a>
                                                            </div>
                                                        </div>
                                                        imageCounter++;
                                                    }
                                                }
                                            </div>
                                            <div class="row">
                                                <div class="col-4 col-lg-2  text-center m-2 text-success" id="UploadPhotoInputContainer">
                                                    <label for="ZoneImageInput_@counter" class="p-4">
                                                        <i class="fas fa-plus "></i>
                                                        <input type="file" style="display:none;" onChange="PreviewZoneIssuesImage(event,'@zone.Id','@(counter + 1)')" id="ZoneImageInput_@counter" />
                                                        <p>Upload Photo</p>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer d-flex justify-content-center">
                                            <button type="button" class="btn btn-success" onclick="$('.modal').modal('hide')">Save & Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--Zone issues images popup ends-->
                            counter++;
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>


